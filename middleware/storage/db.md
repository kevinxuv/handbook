# 数据库(DB)

## mysql

### 性能优化

#### 设计层面
* 业务解耦，分库是建立在业务领域划分的基础上，低耦合会使得数据库的压力均衡，在数据库运维方面的成本会较低，比如 
    1. 实例的扩容缩容的时候会比较好做，因为你的峰值是跟业务成正相关，可以很容易判断需扩容的峰值
    2. 峰值规律跟业务相关，监控成本较低，可以更好的做报警以及自动报警
* 业务建模设计尽量做到抽象，每个需要持久化存储的实体对应一张表
* 根据业务尽量做到实体抽象，实体与实体之间尽量不要有冗余字段，减少多余的存储，避免业务上数据不一致
* 选择正确的引擎，一般都选择innodb
* 尽量的使用not null，null也是要占用空间的，而且当你查询条件为null的时候是触发表锁
* 冷热分离，有助于提高MySQL本身的缓存命中率和服务自己做的缓存命中率
* 作为查询条件的字段尽量建索引
* 分片，当超过千万条记录的表最好做sharding，提升读写性能
* 定期归档，做了sharding之后由于历史累积使得每隔分片上的记录数超过千万，业务如果不依赖历史数据，根据业务规则进行定时归档，如果归档数据不需要查询直接进行离线存储

#### 应用层面
* 查询避免用join语句进行连表查询，join可以放在应用代码实现
* 最好是顺序的写，避免频繁的update同一条记录，目的是避免引发行锁
* 查询条件尽量建索引，目的是避免引发表锁
* 查询避免select *，按需显式的列出所需字段查询
* 数据库的读写尽量做到分离，除非业务特殊
* 数据库的连接用连接池，保持连接复用，提高连接复用率，降低网络IO的消耗

## postgrel

## influxdb

`sudo apt-get update && sudo apt-get install influxdb`

`sudo systemctl unmusk influxdb.service`

`sudo systemctl start influxdb`
